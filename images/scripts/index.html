<html>

<head>
  <title>UFO Hunter Game</title>

</head>

<body>

<canvas id="ufocanvas"></canvas>

<style>
#ufocanvas {
  border: 1px solid black;
  margin: 0 auto;
  display: block;
  background-image: url("/Users/anasmaryam/Documents/images/field-background 2.jpg")


}

body {
  background-image: url("/Users/anasmaryam/Documents/images/background copy.jpg")
}

</style>

<script>

// Canvas drawing
const canvas = document.getElementById('ufocanvas');
canvas.width = 900;
canvas.height = 750;
const ctx = canvas.getContext('2d');

// Canvas automatic resizing
function resize() {
  // Our canvas must cover full height of screen regardless of the resolution
  const height = window.innerHeight - 20;

  // So we need to calculate the proper scaled width that should work well with every resolution
  const ratio = canvas.width / canvas.height;
  const width = height * ratio;

  canvas.style.width = width + 'px';
  canvas.style.height = height + 'px';
}
window.addEventListener('load', resize, false);

// Game Basics
function GameBasics(canvas) {

  this.canvas = canvas;
  this.width = canvas.width;
  this.height = canvas.height;

  // active playing field
  this.playBoundaries = {
    top: 150,
    bottom: 650,
    left: 100,
    right: 800
  };

  // initial values
  this.level = 1;
  this.score = 0;
  this.shields = 2;

  // game settings
  this.setting = {
    updateSeconds: (1 / 60), //FPS: 60 frame per 1 second, this means 1 new frame in every 0,01666667 seconds
    spaceshipSpeed: 200, //our spaceship's speed

    bulletSpeed: 130, //bullets speed of spaceship
    bulletMaxFrequency: 500, //how fast our spaceship can shoot one after another

    ufoLines: 4, //number of UFO lines
    ufoColumns: 8, //number of UFO columns
    ufoSpeed: 35, //speed of UFO
    ufoSinkingValue: 30, //that's how much the UFO sinks, value of sinking

    bombSpeed: 75, //bomb falling speed
    bombFrequency: 0.05, //bomb dropping frequency

    pointsPerUFO: 25, //points per UFO value
  };

  // we collect here the different positions, states of the game
  this.positionContainer = [];

  // pressed keys storing
  this.pressedKeys = {};
}

//  Return to current game position, status. Always returns the top element of positionContainer.
GameBasics.prototype.presentPosition = function () {
  return this.positionContainer.length > 0 ? this.positionContainer[this.positionContainer.length - 1] : null;
};

// Move to the desired position
GameBasics.prototype.goToPosition = function (position) {
  // If we're already in a position clear the positionContainer.
  if (this.presentPosition()) {
    this.positionContainer.length = 0;
  }
  // If we finds an 'entry' in a given position, we call it.
  if (position.entry) {
    position.entry(play);
  }
  // Setting the current game position in the positionContainer
  this.positionContainer.push(position);
};

// Push our new position into the positionContainer
GameBasics.prototype.pushPosition = function (position) {
  this.positionContainer.push(position);
};

// Pop the position from the positionContainer
GameBasics.prototype.popPosition = function () {
  this.positionContainer.pop();
};

// GameBasics start - Starting the loop
GameBasics.prototype.start = function () {
  //Specify the interval in milliseconds
  setInterval(function () { gameLoop(play); }, this.setting.updateSeconds * 1000); //0,01666667 sec * 1000 = 16,67 ms
  //Go into the Opening position
  this.goToPosition(new OpeningPosition());
}

// Notifies the game when a key is pressed
GameBasics.prototype.keyDown = function (keyboardCode) {
  // store the pressed key in 'pressedKeys'
  this.pressedKeys[keyboardCode] = true;
  //  it calls the present position's keyDown function
  if (this.presentPosition() && this.presentPosition().keyDown) {
    this.presentPosition().keyDown(this, keyboardCode);
  }
};

//  Notifies the game when a key is released
GameBasics.prototype.keyUp = function (keyboardCode) {
  // delete the released key from 'pressedKeys'
  delete this.pressedKeys[keyboardCode];
};

// Game Loop
function gameLoop(play) {
  let presentPosition = play.presentPosition();

  if (presentPosition) {
    // update
    if (presentPosition.update) {
      presentPosition.update(play);
    }
    // draw
    if (presentPosition.draw) {
      presentPosition.draw(play);
    }
  }
}

// Keyboard events listening
window.addEventListener("keydown", function (e) {
  const keyboardCode = e.which || event.keyCode; // Use either which or keyCode, depending on browser support
  if (keyboardCode == 37 || keyboardCode == 39 || keyboardCode == 32) { e.preventDefault(); } //space/left/right (32/37/29)
  play.keyDown(keyboardCode);
});

window.addEventListener("keyup", function (e) {
  const keyboardCode = e.which || event.keyCode; // Use either which or keyCode, depending on browser support
  play.keyUp(keyboardCode);
});
Sounds.prototype.init = function () {
    this.soundsSource = ["/Users/anasmaryam/Documents/images/sounds/shot.mp3", "/Users/anasmaryam/Documents/images/sounds/ufoDeath.mp3", "/Users/anasmaryam/Documents/images/sounds/explosion.mp3"];
    this.allSounds = [];

    for (let i = 0; i < this.soundsSource.length; i++) {
        this.allSounds[i] = new Audio();
        this.allSounds[i].src = this.soundsSource[i];
        this.allSounds[i].setAttribute("preload", "auto");
    }
};

// Create a GameBasics object
const play = new GameBasics(canvas);
play.sounds = new Sounds();
play.sounds.init();
play.start();

function Objects() {
};

Objects.prototype.spaceship = function (x, y, spaceship_image) {
	this.x = x;
	this.y = y;
	this.width = 34;
	this.height = 28;
	this.spaceship_image = spaceship_image;
	this.spaceship_image.src = "/Users/anasmaryam/Documents/images/ship.png";
	return this;
};

Objects.prototype.bullet = function(x, y) {
    this.x = x;
    this.y = y;
	return this;
};

Objects.prototype.ufo = function(x, y, line, column, ufo_image, level) {
    this.x = x;
    this.y = y;
    this.line = line;
    this.column = column;
    this.width = 32;
    this.height = 24;
	this.ufo_image = ufo_image;
	this.level = level;
	//this.ufo_image.src = "images/ufo.png"
	this.ufo_image.src = (this.level%2==0) ? "/Users/anasmaryam/Documents/images/ufo2.png" : "/Users/anasmaryam/Documents/images/ufo.png"; //even-odd level selector
	return this;
};

Objects.prototype.bomb = function(x, y) {
    this.x = x;
    this.y = y;
	return this;
};

function GameOverPosition() {
}

GameOverPosition.prototype.draw = function(play) {
    ctx.clearRect(0, 0, play.width, play.height);
    ctx.font="40px Comic Sans MS";
    ctx.textAlign="center";
    ctx.fillStyle = '#ffffff';
    ctx.fillText("Game Over!", play.width / 2, play.height/2 - 120);

	ctx.font="36px Comic Sans MS";
    ctx.fillStyle = '#D7DF01';
    ctx.fillText("You've reached level " + play.level + " and your score is " + play.score + ".", play.width / 2, play.height/2 - 40);

	ctx.font="36px Comic Sans MS";
    ctx.fillStyle = '#D7DF01';
    ctx.fillText("Press 'Space' to continue.", play.width / 2, play.height/2 + 40);
};

GameOverPosition.prototype.keyDown = function(play, keyboardCode) {
    if(keyboardCode == 32)  {
        play.goToPosition(new OpeningPosition());
    }
};
function InGamePosition(setting, level) {
    this.setting = setting;
    this.level = level;
    this.object = null;
    this.spaceship = null;
    this.bullets = [];
    this.lastBulletTime = null;
    this.ufos = [];
    this.bombs = [];
}

InGamePosition.prototype.entry = function (play) {
    this.spaceship_image = new Image();
    this.ufo_image = new Image();
    this.upSec = this.setting.updateSeconds;
    this.turnAround = 1;
    this.horizontalMoving = 1;
    this.verticalMoving = 0;
    this.ufosAreSinking = false;
    this.ufoPresentSinkingValue = 0;

    // Values ​​that change with levels (1. UFO speed, 2. Bomb falling speed, 3. Bomb dropping frequency)
    let presentLevel = this.level < 11 ? this.level : 10;
    console.log("Level: " + this.level + " PresentLevel number: " + presentLevel);
    // 1. UFO speed
    this.ufoSpeed = this.setting.ufoSpeed + (presentLevel * 7); //Level1: 35 + (1*7) = 42, Level2: 35 + (2*7) = 49, ...
    // 2. Bomb falling speed
    this.bombSpeed = this.setting.bombSpeed + (presentLevel * 10); //Level1: 75 + (1*10) = 85, Level2: 75 + (2*10) = 95, ...
    // 3. Bomb dropping frequency
    this.bombFrequency = this.setting.bombFrequency + (presentLevel * 0.05); //Level1: 0.05 + (1*0.05) = 0.1, Level2: 0.05 + (2*0.05) = 0.15 ...

    // Creating Spaceship
    this.spaceshipSpeed = this.setting.spaceshipSpeed;
    this.object = new Objects();
    this.spaceship = this.object.spaceship((play.width / 2), play.playBoundaries.bottom, this.spaceship_image);

    // Creating UFOS
    const lines = this.setting.ufoLines;
    const columns = this.setting.ufoColumns;
    const ufosInitial = [];

    let line, column;
    for (line = 0; line < lines; line++) {
        for (column = 0; column < columns; column++) {
            this.object = new Objects();
            let x, y;
            x = (play.width / 2) + (column * 50) - ((columns - 1) * 25);
            y = (play.playBoundaries.top + 30) + (line * 30);
            ufosInitial.push(this.object.ufo(
                x,
                y,
                line,
                column,
                this.ufo_image,
                this.level
            ));
        }
    }
    this.ufos = ufosInitial;
};

InGamePosition.prototype.update = function (play) {
    const spaceship = this.spaceship;
    const spaceshipSpeed = this.spaceshipSpeed;
    const upSec = this.setting.updateSeconds;
    const bullets = this.bullets;

    // Keyboard events
    if (play.pressedKeys[37]) {
        spaceship.x -= spaceshipSpeed * upSec;
    }
    if (play.pressedKeys[39]) {
        spaceship.x += spaceshipSpeed * upSec;
    }
    if (play.pressedKeys[32]) {
        this.shoot();
    }

    // Keep spaceship in 'Active playing field'
    if (spaceship.x < play.playBoundaries.left) {
        spaceship.x = play.playBoundaries.left;
    }
    if (spaceship.x > play.playBoundaries.right) {
        spaceship.x = play.playBoundaries.right;
    }

    //  Moving bullets
    for (let i = 0; i < bullets.length; i++) {
        let bullet = bullets[i];
        bullet.y -= upSec * this.setting.bulletSpeed;
        // If our bullet flies out from the canvas it will be cleared
        if (bullet.y < 0) {
            bullets.splice(i--, 1);
        }
    }

    // Movements of UFOS
    let reachedSide = false;

    for (let i = 0; i < this.ufos.length; i++) {
        let ufo = this.ufos[i];
        let fresh_x = ufo.x + this.ufoSpeed * upSec * this.turnAround * this.horizontalMoving;
        let fresh_y = ufo.y + this.ufoSpeed * upSec * this.verticalMoving;
        if (fresh_x > play.playBoundaries.right || fresh_x < play.playBoundaries.left) {
            this.turnAround *= -1;
            reachedSide = true;
            this.horizontalMoving = 0;
            this.verticalMoving = 1;
            this.ufosAreSinking = true;
        }
        if (reachedSide !== true) {
            ufo.x = fresh_x;
            ufo.y = fresh_y;
        }
    }

    if (this.ufosAreSinking == true) {
        this.ufoPresentSinkingValue += this.ufoSpeed * upSec;
        if (this.ufoPresentSinkingValue >= this.setting.ufoSinkingValue) {
            this.ufosAreSinking = false;
            this.verticalMoving = 0;
            this.horizontalMoving = 1;
            this.ufoPresentSinkingValue = 0;
        }
    }

    // UFOS bombing
    // Sorting UFOS - which are at the bottom of each column
    const frontLineUFOs = [];
    for (let i = 0; i < this.ufos.length; i++) {
        let ufo = this.ufos[i];
        if (!frontLineUFOs[ufo.column] || frontLineUFOs[ufo.column].line < ufo.line) {
            frontLineUFOs[ufo.column] = ufo;
        }
    }

    // Give a chance for bombing
    for (let i = 0; i < this.setting.ufoColumns; i++) {
        let ufo = frontLineUFOs[i];
        if (!ufo) continue;
        let chance = this.bombFrequency * upSec;
        this.object = new Objects();
        if (chance > Math.random()) {
            // make a bomb object and put it into bombs array
            this.bombs.push(this.object.bomb(ufo.x, ufo.y + ufo.height / 2));
        }
    }

    // Moving bombs
    for (let i = 0; i < this.bombs.length; i++) {
        let bomb = this.bombs[i];
        bomb.y += upSec * this.bombSpeed;
        // If a bomb falls out of the canvas it will be deleted
        if (bomb.y > this.height) {
            this.bombs.splice(i--, 1);
        }
    }

    // UFO-bullet collision
    for (let i = 0; i < this.ufos.length; i++) {
        let ufo = this.ufos[i];
        let collision = false;
        for (let j = 0; j < bullets.length; j++) {
            let bullet = bullets[j];
            // collision check
            if (bullet.x >= (ufo.x - ufo.width / 2) && bullet.x <= (ufo.x + ufo.width / 2) &&
                bullet.y >= (ufo.y - ufo.height / 2) && bullet.y <= (ufo.y + ufo.height / 2)) {
                // if there is collision we delete the bullet and set collision true
                bullets.splice(j--, 1);
                collision = true;
                play.score += this.setting.pointsPerUFO;
            }
        }
        // if there is collision we delete the UFO
        if (collision == true) {
            this.ufos.splice(i--, 1);
            play.sounds.playSound('/Users/anasmaryam/Documents/images/sounds/ufoDeath.mp3');
        }
    }

    // Spaceship-bomb collision
    for (let i = 0; i < this.bombs.length; i++) {
        let bomb = this.bombs[i];
        if (bomb.x + 2 >= (spaceship.x - spaceship.width / 2) &&
            bomb.x - 2 <= (spaceship.x + spaceship.width / 2) &&
            bomb.y + 6 >= (spaceship.y - spaceship.height / 2) &&
            bomb.y <= (spaceship.y + spaceship.height / 2)) {
            // if there is collision we delete the bomb
            this.bombs.splice(i--, 1);
            // effect on the spaceship
            play.sounds.playSound('/Users/anasmaryam/Documents/images/sounds/explosion.mp3');
            play.shields--; //one hit
        }
    }

    // Spaceship-UFO collision
    for (let i = 0; i < this.ufos.length; i++) {
        let ufo = this.ufos[i];
        if ((ufo.x + ufo.width / 2) > (spaceship.x - spaceship.width / 2) &&
            (ufo.x - ufo.width / 2) < (spaceship.x + spaceship.width / 2) &&
            (ufo.y + ufo.height / 2) > (spaceship.y - spaceship.height / 2) &&
            (ufo.y - ufo.height / 2) < (spaceship.y + spaceship.height / 2)) {
            // if there is collision the spaceship explodes
            play.sounds.playSound('/Users/anasmaryam/Documents/images/sounds/explosion.mp3');
            play.shields = -1; //instant death
        }
    }

    // Spaceship death check
    if (play.shields < 0) {
        play.goToPosition(new GameOverPosition());
    }

    // Level completed
    if (this.ufos.length == 0) {
        play.level += 1;
        play.goToPosition(new TransferPosition(play.level));
        play.shields += 1;
        this.setting.ufoSpeed += 3;
        this.bulletSpeed += 4;
    }
};

InGamePosition.prototype.shoot = function () {
    if (this.lastBulletTime === null || ((new Date()).getTime() - this.lastBulletTime) > (this.setting.bulletMaxFrequency)) {
        this.object = new Objects();
        this.bullets.push(this.object.bullet(this.spaceship.x, this.spaceship.y - this.spaceship.height / 2, this.setting.bulletSpeed));
        this.lastBulletTime = (new Date()).getTime();
        play.sounds.playSound('/Users/anasmaryam/Documents/images/sounds/shot.mp3');
    }
};

InGamePosition.prototype.draw = function (play) {
    // draw Spaceship
    ctx.clearRect(0, 0, play.width, play.height);
    ctx.drawImage(this.spaceship_image, this.spaceship.x - (this.spaceship.width / 2), this.spaceship.y - (this.spaceship.height / 2));

    // draw Bullets
    ctx.fillStyle = '#ff0000';
    for (let i = 0; i < this.bullets.length; i++) {
        let bullet = this.bullets[i];
        ctx.fillRect(bullet.x - 1, bullet.y - 6, 2, 6);
    }

    // draw UFOS
    for (let i = 0; i < this.ufos.length; i++) {
        let ufo = this.ufos[i];
        ctx.drawImage(this.ufo_image, ufo.x - (ufo.width / 2), ufo.y - (ufo.height / 2));
    }

    // draw bombs
    ctx.fillStyle = "#FE2EF7";
    for (let i = 0; i < this.bombs.length; i++) {
        let bomb = this.bombs[i];
        ctx.fillRect(bomb.x - 2, bomb.y, 4, 6);
    }

    // draw Sound & Mute info
    ctx.font = "16px Comic Sans MS";

    ctx.fillStyle = "#424242";
    ctx.textAlign = "left";
    ctx.fillText("Press S to switch sound effects ON/OFF.  Sound:", play.playBoundaries.left, play.playBoundaries.bottom + 70);

    let soundStatus = (play.sounds.muted === true) ? "OFF" : "ON";
    ctx.fillStyle = (play.sounds.muted === true) ? '#FF0000' : '#0B6121';
    ctx.fillText(soundStatus, play.playBoundaries.left + 375, play.playBoundaries.bottom + 70);

    ctx.fillStyle = '#424242';
    ctx.textAlign = "right";
    ctx.fillText("Press P to Pause.", play.playBoundaries.right, play.playBoundaries.bottom + 70);

    // draw Score & Level
    ctx.textAlign = "center";
    ctx.fillStyle = '#BDBDBD';

    ctx.font = "bold 24px Comic Sans MS";
    ctx.fillText("Score", play.playBoundaries.right, play.playBoundaries.top - 75);
    ctx.font = "bold 30px Comic Sans MS";
    ctx.fillText(play.score, play.playBoundaries.right, play.playBoundaries.top - 25);

    ctx.font = "bold 24px Comic Sans MS";
    ctx.fillText("Level", play.playBoundaries.left, play.playBoundaries.top - 75);
    ctx.font = "bold 30px Comic Sans MS";
    ctx.fillText(play.level, play.playBoundaries.left, play.playBoundaries.top - 25);

    // draw Shields
    ctx.textAlign = "center";
    if (play.shields > 0) {
        ctx.fillStyle = '#BDBDBD';
        ctx.font = "bold 24px Comic Sans MS";
        ctx.fillText("Shields", play.width / 2, play.playBoundaries.top - 75);
        ctx.font = "bold 30px Comic Sans MS";
        ctx.fillText(play.shields, play.width / 2, play.playBoundaries.top - 25);
    }
    else {
        ctx.fillStyle = '#ff4d4d';
        ctx.font = "bold 24px Comic Sans MS";
        ctx.fillText("WARNING HAZARD", play.width / 2, play.playBoundaries.top - 75);
        ctx.fillStyle = '#BDBDBD';
        ctx.fillText("No shields left!", play.width / 2, play.playBoundaries.top - 25);
        ctx.fillText("If you make it to the next level your shields will increase",play.width / 2,play.playBoundaries.top - 0);
    }
};

InGamePosition.prototype.keyDown = function (play, keyboardCode) {
    if (keyboardCode == 83) {   // Mute sound: S
        play.sounds.muteSwitch();
    }
    if (keyboardCode == 80) {   // Pause: P
        play.pushPosition(new PausePosition());
    }
};



function OpeningPosition() {
}

OpeningPosition.prototype.draw = function(play) {
	// UFO Hunter
    ctx.clearRect(0, 0, play.width, play.height);
	ctx.font="80px Comic Sans MS";
    ctx.textAlign="center";
	const gradient = ctx.createLinearGradient((play.width/2-180),(play.height/2), (play.width/2+180), (play.height/2));
	gradient.addColorStop("0","yellow");
	gradient.addColorStop("0.5","red");
	gradient.addColorStop("1.0","yellow");
	ctx.fillStyle = gradient;
    ctx.fillText("UFO HUNTER 2", play.width / 2, play.height/2 - 70);

    // Press 'Space' to start.
    ctx.font="40px Comic Sans MS";
    ctx.fillStyle = '#D7DF01';
    ctx.fillText("Press 'Space' to start.", play.width / 2, play.height/2);

    // Game Controls
    ctx.fillStyle = '#2e2f00';
    ctx.fillText("Game Controls", play.width / 2, play.height/2 + 210);
    ctx.fillText("Left Arrow : Move Left", play.width / 2, play.height/2 + 260);
    ctx.fillText("Right Arrow : Move Right", play.width / 2, play.height/2 + 300);
    ctx.fillText("Space : Fire", play.width / 2, play.height/2 + 340);
};

OpeningPosition.prototype.keyDown = function(play, keyboardCode) {
    if(keyboardCode == 32)  {
        play.level = 1;
        play.score = 0;
        play.shields = 2;
        play.goToPosition(new TransferPosition(play.level));
    }
};
function PausePosition() {
}

PausePosition.prototype.draw = function(play) {
    ctx.clearRect(0, 0, play.width, play.height);
    ctx.font="40px Comic Sans MS";
    ctx.fillStyle = '#ffffff';
    ctx.textAlign="center";
    ctx.fillText("Paused", play.width / 2, play.height/2 - 300);

    ctx.fillStyle = '#D7DF01';
	ctx.font="36px Comic Sans MS";
	ctx.fillText("P: back to the current game", play.width / 2, play.height/2 - 250 );
    ctx.fillText("ESC: quit the current game", play.width / 2, play.height/2 - 210);

    ctx.font="40px Comic Sans MS";
    ctx.fillStyle = '#ffffff';
	ctx.fillText("Game controls reminder", play.width / 2, play.height/2 - 120);
	ctx.fillStyle = '#D7DF01';
	ctx.font="36px Comic Sans MS";
	ctx.fillText("Left Arrow : Move Left", play.width / 2, play.height/2 - 70);
	ctx.fillText("Right Arrow : Move Right", play.width / 2, play.height/2 - 30);
	ctx.fillText("Space : Fire", play.width / 2, play.height/2 + 10);
};

PausePosition.prototype.keyDown = function(play, keyboardCode) {
    if(keyboardCode == 80) { // Back: P
        play.popPosition();
    }
    if(keyboardCode == 27) { // Quit: ESC
        play.pushPosition(new GameOverPosition());
    }
};


function TransferPosition(level) {
    this.level = level;
    this.fontSize = 140;
    this.fontColor = 255;
}

TransferPosition.prototype.update = function (play) {
    this.fontSize -= 1;
    this.fontColor -= 1.5;
    if (this.fontSize < 1) {
        //  if the condition is met it will go to the InGamePosition
        play.goToPosition(new InGamePosition(play.setting, this.level));
    }
};

TransferPosition.prototype.draw = function (play) {
    ctx.clearRect(0, 0, play.width, play.height);
    ctx.font = this.fontSize + "px Comic Sans MS";
    ctx.textAlign = "center";
    ctx.fillStyle = "rgba(255, " + this.fontColor + ", " + this.fontColor + ", 1)";
    ctx.fillText("Get ready for level " + this.level, play.width / 2, play.height / 2);
};

function Sounds() {
    this.muted = false;
}


Sounds.prototype.playSound = function (soundName) {
    if (this.muted === true) {
        return;
    }

    let soundNumber;
    switch (soundName) {
        case '/Users/anasmaryam/Documents/images/sounds/shot.mp3':
            soundNumber = 0;
            break;
        case '/Users/anasmaryam/Documents/images/sounds/ufoDeath.mp3':
            soundNumber = 1;
            break;
        case '/Users/anasmaryam/Documents/images/sounds/explosion.mp3':
            soundNumber = 2;
            break;
        default:
            break;
    }
    this.allSounds[soundNumber].play();
    this.allSounds[soundNumber].currentTime = 0;
};

Sounds.prototype.muteSwitch = function () {
    if (this.muted === false) {
        this.muted = true;
    } else if (this.muted === true) {
        this.muted = false;
    }
};


</script>
</body>

</html>
